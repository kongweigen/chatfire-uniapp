"use strict";const e=require("../../common/vendor.js"),a=require("../../api/index.js"),i=require("../../api/image/index.js");exports.useClear=()=>{const r=e.ref({width:"700rpx",height:"100rpx",color:"#ffffff",fontSize:"42rpx",borderRadius:"50rpx",background:"#007CFF"}),t=e.ref(!1),l=e.ref(!1),o=e.ref(""),s=e.ref(""),n=async e=>{o.value=setInterval((async()=>{if(l.value)return;l.value=!0;const i=await a.getTaskById(e).catch((()=>{c()}));l.value=!1,i.picArr&&(s.value=i.picArr[0].src,c())}),3e3)},c=()=>{e.index.hideLoading(),l.value=!1,t.value=!1,clearInterval(o.value)},d=e.ref({});return{customStyle:r,sourceImage:d,imageUrl:s,uploadImage:()=>{e.index.chooseImage({success:a=>{const i=a.tempFiles[0],r=a.tempFilePaths[0];e.index.showLoading({mask:!0,title:"正在上传"}),e.index.uploadFile({url:"https://agi.chatfire.cn/box/chat/file",filePath:r,name:"file",header:{Authorization:"Bearer eyJhbGciOiJIUzUxMiJ9.eyJ1c2VyX2lkIjoxODI0MTAyMzM0OTkzNzcyNTQ0LCJ1c2VyX2tleSI6IjgyMTIxYjdhLWU3MjMtNDYwMC1hMTlhLTAxYmIzODUzMWY0YSIsInVzZXJuYW1lIjoidGVzdCJ9.QckzY4WTJRTe9E0CGdlrzpL_DuQBBJnT7DYOjAJVmVhsLotGKnP597A-jBqid8H7UnMFiwG1JFRSf63PzvBvuQ"},formData:{file:i,purpose:"oss"},success:a=>{e.index.hideLoading(),d.value=JSON.parse(a.data).data},fail:()=>{e.index.hideLoading()}})}})},generate:async()=>{const a=(r=d.value.url,t=d.value.url,{type:"3",original_url:r,thumb_url:t,query:"ChatfireAI图片助手",image_source:"1",picInfo:"",picInfo2:"",text:"",ext_ratio:"",expand_zoom:"",clid:"1",front_display:"2",create_level:"0",style:"",is_first:!0});var r,t;console.log("generateImagePcedit ",a),e.index.showLoading({mask:!0,title:"AI 处理中"});const l=await i.generateImagePcedit(a).catch((()=>c()));l&&n(l.id)}}};
